// This file was generated by Mendix Modeler.
//
// WARNING: Only the following code will be retained when actions are regenerated:
// - the import list
// - the code between BEGIN USER CODE and END USER CODE
// - the code between BEGIN EXTRA CODE and END EXTRA CODE
// Other code you write will be lost the next time you deploy the project.
// Special characters, e.g., é, ö, à, etc. are supported in comments.

package importexport.actions;

import java.util.List;
import metamodel.proxies.MendixEntity;
import nl.mansystems.mendiximportexport.SharedFunctions;
import com.mendix.core.Core;
import com.mendix.systemwideinterfaces.core.IMendixObject;
import com.mendix.systemwideinterfaces.core.IContext;
import com.mendix.webui.CustomJavaAction;

public class ImportDataFromExcelByContents extends CustomJavaAction<java.lang.Boolean>
{
	private IMendixObject __ImportExportSettingParameter1;
	private importexport.proxies.ImportExportSetting ImportExportSettingParameter1;
	private IMendixObject __ImportAttemptParameter1;
	private importexport.proxies.ImportAttempt ImportAttemptParameter1;
	private java.lang.String ObjectName;
	private java.lang.String FileName;
	private java.lang.Boolean CreateData;
	private java.lang.Boolean UpdateData;
	private java.lang.Boolean ImportNonDelayedRelations;
	private java.lang.Boolean ImportDelayedRelations;
	private java.lang.Boolean FindDataOnly;

	public ImportDataFromExcelByContents(IContext context, IMendixObject ImportExportSettingParameter1, IMendixObject ImportAttemptParameter1, java.lang.String ObjectName, java.lang.String FileName, java.lang.Boolean CreateData, java.lang.Boolean UpdateData, java.lang.Boolean ImportNonDelayedRelations, java.lang.Boolean ImportDelayedRelations, java.lang.Boolean FindDataOnly)
	{
		super(context);
		this.__ImportExportSettingParameter1 = ImportExportSettingParameter1;
		this.__ImportAttemptParameter1 = ImportAttemptParameter1;
		this.ObjectName = ObjectName;
		this.FileName = FileName;
		this.CreateData = CreateData;
		this.UpdateData = UpdateData;
		this.ImportNonDelayedRelations = ImportNonDelayedRelations;
		this.ImportDelayedRelations = ImportDelayedRelations;
		this.FindDataOnly = FindDataOnly;
	}

	@Override
	public java.lang.Boolean executeAction() throws Exception
	{
		this.ImportExportSettingParameter1 = __ImportExportSettingParameter1 == null ? null : importexport.proxies.ImportExportSetting.initialize(getContext(), __ImportExportSettingParameter1);

		this.ImportAttemptParameter1 = __ImportAttemptParameter1 == null ? null : importexport.proxies.ImportAttempt.initialize(getContext(), __ImportAttemptParameter1);

		// BEGIN USER CODE
		nl.mansystems.mendiximportexport.ImportDataFromExcelByContents iebc = new nl.mansystems.mendiximportexport.ImportDataFromExcelByContents(this.getContext(), ImportExportSettingParameter1, ObjectName, FileName, CreateData, UpdateData, ImportNonDelayedRelations, ImportDelayedRelations, FindDataOnly);
		boolean result = true;
		if(this.ImportAttemptParameter1 != null) iebc.setImportAttempt(this.ImportAttemptParameter1);
		MendixEntity mendixEntity = SharedFunctions.getEntityInfo(this.getContext(), ObjectName, 0).getMendixEntity();
		if (mendixEntity != null && mendixEntity.getHasDynamicData()) {
			if(mendixEntity.getDDAllTypesXPath() != null){
				List<IMendixObject> typeList = Core.retrieveXPathQuery(this.getContext(), mendixEntity.getDDAllTypesXPath());
				if (typeList!=null) for(IMendixObject typeObject:typeList) {
					Core.getLogger("ImportDataFromExcel").debug("Trying to import " + ObjectName + " with type " + typeObject.getValue(this.getContext(), mendixEntity.getDDTypeNameAttribute()));
					result = result && iebc.executeAction(typeObject);
				}
			} else { 
				iebc.logError("Entity [" + mendixEntity.getName() + "] is marked to have dynamic data, but has no value for attribute [" + MendixEntity.MemberNames.DDAllTypesXPath.toString() + "]");
				result = false;
			}
			return result;
		} else {
			Core.getLogger("ImportDataFromExcel").debug("Trying to import " + ObjectName);
			result = iebc.executeAction(null);
		}

		if (!ImportExportSettingParameter1.getSuppressFileNotFoundWarnings() || !result) {
			String resultStr = "Run finished for object: " + ObjectName + " and from file " + FileName + (result?"":" interrupted due to an error") + ", with " + iebc.getRowErrors() + " row errors and " + iebc.getRowWarnings() + " row warnings.";
			Core.getLogger("ImportDataFromExcel").info(resultStr);
		}
		return result;
		// END USER CODE
	}

	/**
	 * Returns a string representation of this action
	 */
	@Override
	public java.lang.String toString()
	{
		return "ImportDataFromExcelByContents";
	}

	// BEGIN EXTRA CODE
	// END EXTRA CODE
}
